<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Football Match Prediction</title>
    <script src="https://unpkg.com/brain.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  </head>
  <body>
    <h1>Football Match Prediction</h1>
    
    <!-- File Upload Input -->
    <input type="file" id="csv-file" accept=".csv" />
    
    <!-- Prediction Form -->
    <form id="input-form">
      <label for="team">Team (1 for Barcelona, 0 for Real Madrid):</label>
      <input type="number" id="team" name="team" min="0" max="1" required />

      <br />

      <label for="home_away">Home or Away (1 for Home, 0 for Away):</label>
      <input type="number" id="home_away" name="home_away" min="0" max="1" required />

      <br />

      <label for="goals">Last 5 Match Goals (comma separated, e.g. 2,3,1,4,2):</label>
      <input type="text" id="goals" name="goals" required />

      <br />

      <label for="opposition_strength">Opposition Strength (1 for Strong, 0 for Weak):</label>
      <input type="number" id="opposition_strength" name="opposition_strength" min="0" max="1" required />

      <br />

      <label for="injury_status">Injury Status (1 for Injured, 0 for Not Injured):</label>
      <input type="number" id="injury_status" name="injury_status" min="0" max="1" required />

      <br />

      <button type="submit">Predict</button>
    </form>

    <h2>Prediction Result:</h2>
    <p id="prediction">Enter match data to see the prediction.</p>

    <script>
      // Create a new neural network instance
      const network = new brain.NeuralNetwork();
      let trainingData = [];

      // Handle CSV file upload and parse
      document.getElementById("csv-file").addEventListener("change", function (event) {
        const file = event.target.files[0];
        if (file && file.type === "text/csv") {
          Papa.parse(file, {
            complete: function (results) {
              // Process CSV results into a format usable by the neural network
              trainingData = results.data.slice(1).map(row => ({
                input: [
                  parseInt(row[0]), // team (1 or 0)
                  parseInt(row[1]), // home/away (1 or 0)
                  ...row.slice(2, 7).map(Number), // last 5 match goals
                  parseInt(row[7]), // opposition strength (1 or 0)
                  parseInt(row[8]), // injury status (1 or 0)
                ],
                output: [parseInt(row[9])], // next match goals (0 or 1)
              }));
              console.log("Training data:", trainingData);
              
              // Train the network with the loaded data
              network.train(trainingData);
              alert("Training data loaded and neural network trained successfully!");
            },
            header: false,
            skipEmptyLines: true,
          });
        } else {
          alert("Please upload a valid CSV file.");
        }
      });

      // Handle form submission to make a prediction
      document.getElementById("input-form").addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent the form from refreshing the page

        // Get user inputs
        const team = parseInt(document.getElementById("team").value);
        const homeAway = parseInt(document.getElementById("home_away").value);
        const goals = document.getElementById("goals").value.split(",").map(Number);
        const oppositionStrength = parseInt(document.getElementById("opposition_strength").value);
        const injuryStatus = parseInt(document.getElementById("injury_status").value);

        // Ensure the goals input has exactly 5 numbers (for last 5 matches)
        if (goals.length !== 5) {
          alert("Please enter exactly 5 numbers for the last 5 match goals.");
          return;
        }

        // Prepare input for the neural network
        const input = [
          team,
          homeAway,
          ...goals, // Spread the last 5 goals into the input array
          oppositionStrength,
          injuryStatus,
        ];

        // Run prediction using the neural network
        const output = network.run(input);

        // Convert output to binary (0 or 1)
        const prediction = output > 0.5 ? "More than 1 goal" : "1 or fewer goals";

        // Display the prediction result on the page
        document.getElementById("prediction").innerText = `Prediction: The team will score ${prediction}.`;
      });
    </script>
  </body>
</html>
